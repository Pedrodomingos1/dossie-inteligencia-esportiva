{% extends "layout.html" %}
{% block title %}Painel de Controle - Dossiê Esportivo{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <h1 class="h3 fw-bold text-light mb-1">Jogos de Hoje</h1>
        <p class="text-muted small">Inteligência Artificial aplicada ao Futebol em Tempo Real</p>

        <!-- Filtros -->
        <div class="btn-group mb-3" role="group">
            <button type="button" class="btn btn-outline-secondary btn-sm active" onclick="filtrarJogos('all')">Todos</button>
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="filtrarJogos('live')"><i class="fas fa-circle text-danger me-1 small"></i>Ao Vivo</button>
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="filtrarJogos('scheduled')">Próximos</button>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12" id="games-container">
        {% if jogos %}
            {% for jogo in jogos %}
                <div class="sofa-card" data-status="{{ jogo.status }}">
                    <div class="match-info">
                        <div class="match-time">
                            {% if jogo.status == 'live' %}
                                <span class="live-badge">AO VIVO</span>
                            {% else %}
                                {{ jogo.time }}
                            {% endif %}
                        </div>
                        <div class="teams-container">
                            <div class="team-row">
                                <img src="https://ui-avatars.com/api/?name={{ jogo.homeTeam }}&background=333&color=fff&length=2" class="team-logo" alt="{{ jogo.homeTeam }}">
                                <span class="team-name">{{ jogo.homeTeam }}</span>
                            </div>
                            <div class="team-row">
                                <img src="https://ui-avatars.com/api/?name={{ jogo.awayTeam }}&background=333&color=fff&length=2" class="team-logo" alt="{{ jogo.awayTeam }}">
                                <span class="team-name">{{ jogo.awayTeam }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex flex-column align-items-end gap-2">
                        <!-- Odds Fictícias para Visual -->
                        <div class="d-flex gap-1 mb-2 d-none d-md-flex">
                            <span class="odds-badge" title="Vitória Casa">1.85</span>
                            <span class="odds-badge" title="Empate">3.40</span>
                            <span class="odds-badge" title="Vitória Fora">4.10</span>
                        </div>
                        <a href="{{ url_for('principal.gerar_dossie', id_evento=jogo.id, nome_jogo=jogo.nome) }}" class="btn-premium">
                            <i class="fas fa-lock me-1"></i> Gerar Dossiê Premium
                        </a>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="text-center py-5">
                <i class="fas fa-satellite-dish fa-3x text-muted mb-3"></i>
                <p class="text-muted">Buscando sinais de satélite... Nenhum jogo detectado no momento.</p>
            </div>
        {% endif %}
    </div>
</div>

<!-- Seção de Histórico (Compacta) -->
<div class="row mt-5">
    <div class="col-12">
        <h5 class="text-muted mb-3"><i class="fas fa-history me-2"></i>Dossiês Recentes</h5>
        <div class="list-group">
            {% for dossie in dossies %}
                <a href="{{ url_for('principal.visualizar_dossie', id_dossie=dossie.id) }}" class="list-group-item list-group-item-action bg-dark text-light border-secondary d-flex justify-content-between align-items-center">
                    <div>
                        <i class="fas fa-check-circle text-success me-2"></i>
                        {{ dossie.nome_jogo }}
                        <small class="text-muted ms-2">{{ dossie.data_criacao.strftime('%d/%m %H:%M') }}</small>
                    </div>
                    <span class="badge bg-secondary">Ver <i class="fas fa-chevron-right ms-1"></i></span>
                </a>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Scripts de Interatividade -->
<script>
    function filtrarJogos(status) {
        // Atualizar botões
        document.querySelectorAll('.btn-group .btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        const cards = document.querySelectorAll('.sofa-card');
        cards.forEach(card => {
            if (status === 'all') {
                card.style.display = 'flex';
            } else {
                if (card.getAttribute('data-status') === status) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            }
        });
    }
</script>
{% endblock %}
